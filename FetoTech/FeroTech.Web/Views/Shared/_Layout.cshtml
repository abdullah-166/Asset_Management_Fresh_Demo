<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - FeroTech Dashboard</title>

    <!-- Bootstrap CDN (Replaced local ~ link for better preview compatibility) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.4/css/dataTables.dataTables.min.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <!-- Sidenav / Sidebar -->
    <nav class="sidebar" id="sidebar">
        <h2 class="sidebar-logo">FeroTech</h2>

        <ul>
            <!-- Using try-catch for ViewContext to prevent errors in pure HTML preview if not running in full ASP.NET Core -->
            <li class="@((ViewContext?.RouteData?.Values["Controller"]?.ToString() == "Home" && ViewContext?.RouteData?.Values["Action"]?.ToString() == "Index") ? "active" : "")">
                <a asp-controller="Home" asp-action="Index">
                    <i class="fa-solid fa-table-columns"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="@((ViewContext?.RouteData?.Values["Controller"]?.ToString() == "Employee") ? "active" : "")">
                <a asp-controller="Employee" asp-action="Index">
                    <i class="fa-solid fa-users"></i>
                    <span>Employees</span>
                </a>
            </li>
            <li class="@((ViewContext?.RouteData?.Values["Controller"]?.ToString() == "Asset") ? "active" : "")">
                <a asp-controller="Asset" asp-action="Index">
                    <i class="fa-solid fa-briefcase"></i>
                    <span>Assets</span>
                </a>
            </li>
            <li class="@((ViewContext?.RouteData?.Values["Controller"]?.ToString() == "Notification") ? "active" : "")">
                <a asp-controller="Notification" asp-action="Index">
                    <i class="fa-solid fa-bell"></i>
                    <span>Notifications</span>
                </a>
            </li>
            <li class="@((ViewContext?.RouteData?.Values["Controller"]?.ToString() == "Account" && ViewContext?.RouteData?.Values["Action"]?.ToString() == "Register") ? "active" : "")">
                <a asp-controller="Account" asp-action="Register">
                    <i class="fa-solid fa-key"></i>
                    <span>Register</span>
                </a>
            </li>
            <li class="@((ViewContext?.RouteData?.Values["Controller"]?.ToString() == "Home" && ViewContext?.RouteData?.Values["Action"]?.ToString() == "Privacy") ? "active" : "")">
                <a asp-controller="Home" asp-action="Privacy">
                    <i class="fa-solid fa-lock"></i>
                    <span>Privacy</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fa-solid fa-gear"></i>
                    <span>Settings</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content Area -->
    <div class="main-content" id="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle-btn" id="menu-toggle">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <h3>@ViewData["Title"]</h3>
            </div>
            <div class="header-right">
                <div class="notification-container" style="position: relative; margin-left: 25px;">
                    <a href="/Notification/Index" class="notification-bell" style="color: #555; font-size: 20px;">
                        <i class="fa-solid fa-bell"></i>
                        <span id="notifCount" class="badge bg-danger rounded-pill"
                              style="position: absolute; top: -8px; right: -10px; font-size: 10px; padding: 3px 6px; display: none;">
                        </span>
                    </a>
                </div>
                <i class="fa-solid fa-user-circle" style="margin-left: 25px; font-size: 20px; color: #555; cursor: pointer;"></i>
            </div>
        </header>

        <main>
            <div class="container-fluid p-0">
                @RenderBody()
            </div>
        </main>

        <footer class="footer">
            © 2025 - FeroTech.Web
        </footer>
    </div>

    <!-- Scripts -->
    <!-- jQuery CDN (Replaced local ~ link to fix ReferenceError: $ is not defined) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Bootstrap Bundle CDN (Replaced local ~ link) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.4/js/dataTables.min.js"></script>

    <script>
        // Wait for document to be fully loaded before running scripts
        $(document).ready(function() {
            // Sidebar toggle functionality
            $("#menu-toggle").on('click', function (e) {
                e.preventDefault();
                $("#sidebar").toggleClass("collapsed");
                $("#main-content").toggleClass("expanded");
            });

            // Notification count script
            async function loadNotificationCount() {
                try {
                    // Note: This fetch will only work if your app is running and this endpoint exists.
                    // In a static preview, it will fail silently due to the try/catch.
                    const response = await fetch('/Notification/GetUnreadCount');
                    if (response.ok) {
                         const data = await response.json();
                         const badge = $('#notifCount');
                         if (data.count > 0) {
                             badge.text(data.count).show();
                         } else {
                             badge.hide();
                         }
                    }
                } catch (error) {
                    // console.warn('Notification endpoint not reachable in this environment.');
                }
            }

            // Initial load and set interval
            loadNotificationCount();
            setInterval(loadNotificationCount, 10000);
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>